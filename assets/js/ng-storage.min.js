!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["angular"],t):e.hasOwnProperty("angular")?t(e.angular):"object"==typeof exports&&(module.exports=t(require("angular")))}(this,function(y){"use strict";function v(e,t){var n;try{n=e[t]}catch(e){n=!1}if(n){var r="__"+Math.round(1e7*Math.random());try{e[t].setItem(r,r),e[t].removeItem(r,r)}catch(e){n=!1}}return n}return(y=y&&y.module?y:window.angular).module("ngStorage",[]).provider("$localStorage",e("localStorage")).provider("$sessionStorage",e("sessionStorage"));function e(g){var n=v(window,g);return function(){var l="ngStorage-";this.setKeyPrefix=function(e){if("string"!=typeof e)throw new TypeError("[ngStorage] - "+g+"Provider.setKeyPrefix() expects a String.");l=e};var p=y.toJson,d=y.fromJson;this.setSerializer=function(e){if("function"!=typeof e)throw new TypeError("[ngStorage] - "+g+"Provider.setSerializer expects a function.");p=e},this.setDeserializer=function(e){if("function"!=typeof e)throw new TypeError("[ngStorage] - "+g+"Provider.setDeserializer expects a function.");d=e},this.supported=function(){return!!n},this.get=function(e){return n&&d(n.getItem(l+e))},this.set=function(e,t){return n&&n.setItem(l+e,p(t))},this.remove=function(e){n&&n.removeItem(l+e)},this.$get=["$rootScope","$window","$log","$timeout","$document",function(n,e,t,r,o){var i,a,s=l.length,u=v(e,g),c=u||(t.warn("This browser does not support Web Storage!"),{setItem:y.noop,getItem:y.noop,removeItem:y.noop}),f={$default:function(e){for(var t in e)y.isDefined(f[t])||(f[t]=y.copy(e[t]));return f.$sync(),f},$reset:function(e){for(var t in f)"$"===t[0]||delete f[t]&&c.removeItem(l+t);return f.$default(e)},$sync:function(){for(var e,t=0,n=c.length;t<n;t++)(e=c.key(t))&&l===e.slice(0,s)&&(f[e.slice(s)]=d(c.getItem(e)))},$apply:function(){var n;if(a=null,!y.equals(f,i)){for(var e in n=y.copy(i),y.forEach(f,function(e,t){y.isDefined(e)&&"$"!==t[0]&&(c.setItem(l+t,p(e)),delete n[t])}),n)c.removeItem(l+e);i=y.copy(f)}},$supported:function(){return!!u}};return f.$sync(),i=y.copy(f),n.$watch(function(){a||(a=r(f.$apply,100,!1))}),e.addEventListener&&e.addEventListener("storage",function(e){if(e.key){var t=o[0];t.hasFocus&&t.hasFocus()||l!==e.key.slice(0,s)||(e.newValue?f[e.key.slice(s)]=d(e.newValue):delete f[e.key.slice(s)],i=y.copy(f),n.$apply())}}),e.addEventListener&&e.addEventListener("beforeunload",function(){f.$apply()}),f}]}}});