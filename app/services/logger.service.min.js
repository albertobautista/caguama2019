!function(){"use strict";angular.module("app").factory("Logger",["$http","TokenService","$localStorage","$mdToast","$state","BaseUrlService","dataauthService","toastr",function(e,o,t,a,r,n,l,s){var i=0,c=0,u=0,g=0,d=0,h=localStorage.baseurl,S={method:"get",url:"",headers:{Authorization:localStorage.tokenkey,"Content-Type":"application/json; charset=UTF-8","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization, X-Requested-With"}};return{get:function t(){{if(null!=localStorage.tokenkey)return null!=h?(S.url=h+"/services/apexrest/t2go1/Login/?user_id="+localStorage.codeAgent,d=0):(0==d?n.get().then(function(e){h=e.BASEURL,localStorage.setItem("baseurl",e.BASEURL),t()}):console.log("ERROR in logger.service.js :::: BASEURL = NULL"),d++),S.headers.Authorization=localStorage.tokenkey,e(S).then(function(e){if(c=0,null!=e.data.agentCode)return u=0,localStorage.setItem("agentCode",e.data.agentCode),localStorage.setItem("name",e.data.name),localStorage.setItem("photo",e.data.photo),localStorage.setItem("myGroup",e.data.myGroup),localStorage.setItem("hours",e.data.hours),e.data;0==u?setTimeout(function(){t(),u++},500):(u=0,m()),u++}).catch(function(e){if("Unauthorized"==e.statusText){if(0!=c)return console.log("ERROR in logger.service.js"),console.log(e),c=0,e;o.get().then(function(e){c++,localStorage.setItem("tokenkey","Bearer "+e.TOKEN),S.headers.Authorization="Bearer "+e.TOKEN,t()})}else"Not Found"!=e.statusText?"Usuario incorrecto"!=e.data.name?"Bad Request"==e.statusText&&0==i?(i++,t()):"Bad Request"!=e.statusText&&(i=0):0==g?(g++,setTimeout(function(){t()},500)):(g=0,m()):m()});o.get().then(function(e){localStorage.setItem("tokenkey","Bearer "+e.TOKEN),S.headers.Authorization="Bearer "+e.TOKEN,this.get()})}}};function m(){s.error("El usuario no tiene un agente ligado a él, contacta al administrador","Notificación",{closeButton:!0,positionClass:"toast-bottom-left"}),localStorage.clear(),r.go("home")}}])}();