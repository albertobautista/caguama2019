!function(){"use strict";function t(t,e,o,n,a,r,s,c,i,l,u,g,d,m,h,f,y,p,v,b){var F,S=this;S.auth=e,S.categories=[{}],S.types=[],S.masterprojects=[],S.stages=[{}],S.logs=[],S.myLogs=[],S.stageModel=null,S.selectedtype=null,S.params=s,S.logForm={date:a("date")(Date.now(),"yyyy/MM/dd"),hours:1,minutes:0},S.getLogs={},S.addLog=function(t){if(!t||0===t.horas)return;var e={reg:{agentCode:localStorage.agentCode,idProject:t.project.idProject,hours:t.hours,idStage:t.stage.idStage,minutes:t.minutes,workDate:moment(t.date).format("YYYY-MM-DD"),comment:t.comment,idCategory:t.category.idCategory}};d.post(e).then(function(t){null!=t&&1==t.success&&(w(S.logForm.stage),F=k(),S.logForm.comment="",S.logForm.hours=1,S.logForm.minutes=0,p.success("Se ha ingresado de forma exitosa el registro de trabajo","Notificaci√≥n",{closeButton:!0,positionClass:"toast-bottom-left"}))})},S.logout=function(){y.$reset(),o.go("login",S.loginForm)},S.setNotice=!0,n.setSpinnerLoad=!0,n.varOpacity=1,S.allowed={minutes:[0,15,30,45],hours:[]},n.project={},n.stage={};for(var j=0;j<25;j++)S.allowed.hours.push(j);function k(){return h.get()}function w(r){if(null!=r){var t={idStage:r.idStage};return d.getWithId(t).then(function(t){if(null!=t)if("Unauthorized"!=t.statusText){n.worklogs=t;var e,o=new Date(localStorage.dateNotice);try{e=new Date(t[0].workDate)}catch(t){}if(e<o||null==e){var a=localStorage.getItem("Notice");(null==a||a<1)&&($("#myModal").modal("show"),S.setNotice=!0,localStorage.setItem("Notice",1))}else S.setNotice=!1,localStorage.setItem("Notice",0)}else w(r);else w(r)})}}1==S.auth.isAuthenticated()?(n.types=null,g.get().then(function(t){n.types=t}),n.alberto=localStorage.agentCode):S.auth.logout(),angular.element(function(){b.get().then(function(t){localStorage.setItem("tokenkey","Bearer "+t.TOKEN)})}),n.$watch("vm.logForm.comment",function(t,e){!0&&149<=(!0).length&&(n.vm.logForm.comment=e)}),m.get(),F=k(),n.myFunca=function(e){if(null!=e){var t={value:e.value,name:e.name};return i.get(t).then(function(t){null!=t&&"Unauthorized"!=t.statusText?(S.projects=t,n.projects=S.projects):n.myFunca(e)})}},n.myFunc=function(e){if(null!=e){var t={idProject:e.idProject,projectName:e.projectName};return l.get(t).then(function(t){null!=t&&"Unauthorized"!=t.statusText?n.stages=t:n.myFunc(e)})}},n.myFunc2=function(e){if(null!=e){var t={idStage:e.idStage,stageName:e.stageName};return u.get(t).then(function(t){null!=t&&"Unauthorized"!=t.statusText?n.categories=t:n.myFunc2(e)})}},n.$watch("vm.selectedtype",function(){return n.myFunca(S.selectedtype)}),n.$watch("vm.logForm.project",function(){return n.myFunc(S.logForm.project)}),n.$watch("vm.logForm.stage",function(){return null!=S.logForm.stage&&w(S.logForm.stage),n.myFunc2(S.logForm.stage)}),F.then(function(t){try{t=JSON.parse(t)}catch(t){console.log(t)}for(var e=[],o=[],s=(e=[],o=[],[]),a=[],r=[],n=[],c=[],i=0,l={},u=["rgba(100,32,119, 1)","rgba(52,217,195, 1)","rgba(66,109,169, 1)","rgba(167,230,217, 1)","rgba(104,2,2, 1)","rgba(210,208,205,1)"],g=(new Date,0);g<t[0].totalHoursProjectXDay.length;g++)e.push(t[0].totalHoursProjectXDay[g]);for(var d in e)for(var m in e[d])s.push(e[d][m]),o.push(Object.keys(e[d]));for(var d in o)for(var m in o[d])a.push(o[d][m]);var h=[new Set(a)];for(g=0;g<s.length;g++)r.push(s[g]);for(var d in r)for(var m in r[d])n.push(r[d][m]);for(g=0;g<n.length;g+=7)l[i]={label:h[i],data:n.slice(g,g+7),backgroundColor:[u[i],u[i],u[i],u[i],u[i],u[i],u[i]],borderColor:[u[i],u[i],u[i],u[i],u[i],u[i],u[i]],borderWidth:3,type:"bar"},i++;c.push(l);var f=[];for(var d in c)for(var m in c[d])f.push(c[d][m]);var y={};$(document).ready(function(){$("button").hover(function(){$(this).css("background","#F5F5F5"),$(this).css("border-radius","90%")},function(){$(this).css("background","#FFFFFF"),$(this).css("border-radius","0%")}),setTimeout(function(){titulo.style.visibility="visible",function(t){var e=Object.keys(s[0]).reverse()[Object.keys(s[0]).reverse().length-1]+" - Actual",o=[];(o=Object.keys(s[0]).reverse()).pop(),o.push(e);var a={labels:o,datasets:[]},r=0;t.forEach(function(t){y[r]={label:[t.label],data:[t.data[6],t.data[5],t.data[4],t.data[3],t.data[2],t.data[1],t.data[0]],backgroundColor:[u[r],u[r],u[r],u[r],u[r],u[r],u[r]]},a.datasets.push(y[r]),r++});var n=document.getElementById("myChartWeek");document.getElementById("titulo"),new Chart(n,{type:"bar",data:a,options:{maintainAspectRatio:!1,scales:{yAxes:[{stacked:!0,ticks:{beginAtZero:!0}}],xAxes:[{stacked:!0,ticks:{beginAtZero:!0}}]}}}).update()}(f)},2e3)})}).catch(function(t){console.log(t)})}angular.module("app").controller("HomeController",t).directive("loading",["$http",function(a){return{restrict:"A",link:function(e,o,t){e.isLoading=function(){return 0<a.pendingRequests.length},e.$watch(e.isLoading,function(t){if(t){try{angular.element("#formPrin")[0].style.opacity="0.4"}catch(t){}e.globalCallout=!0,o.show()}else{try{angular.element("#formPrin")[0].style.opacity="1"}catch(t){}o.hide(),e.globalCallout=!1}})}}}]),t.$inject=["$http","authService","$state","$scope","$filter","$mdToast","$stateParams","$mdDialog","ProjectService","StageService","CategoryService","TypeService","WorkLogService","DashboardService","HomeService","Logger","$localStorage","toastr","$document","TokenService"]}();